language: c
dist: bionic
sudo: false

compiler:
  - clang
  - gcc

before_script:
  - apt-get update && apt-get install -y clang-format-7.0 git-core

script:
  - echo `which clang-format-7.0`
  - ln -s `which clang-format-7.0` /usr/bin/clang-format
  - cd "$CI_PROJECT_DIR"
  - linter_errors=$(git-clang-format-7.0 --commit "HEAD~1" -q --diff | grep -v --color=never "no modified files to format" || true)
  - echo "$linter_errors"
  - if [ ! -z "$linter_errors" ]; then echo "Detected formatting issues; please fix"; exit 1; else echo "Formatting is correct"; exit 0; fi
  - mkdir build && cd build
  - cmake .. && make
  - ./myexample
